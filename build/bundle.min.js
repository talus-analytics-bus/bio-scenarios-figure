"use strict";var Util={};!function(){Util.comma=d3.format(",.0f"),Util.percentize=d3.format("%"),Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},Util.sortByKey=function(t,e,a){return t.sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0}),a?t.reverse():t},Util.getInputNumVal=function(t){var e=$(t),a=Util.strToFloat(e.val());return""===a?0:isNaN(a)||a<0?(e.val(0),0):(e.val(d3.format(",")(a)),a)},Util.populateSelect=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=d3.selectAll(t).selectAll("option").data(e);n.exit().remove();var r=n.enter().append("option");n=r.merge(n).attr("value",function(t){return"function"==typeof a.valKey?a.valKey(t):a.valKey?t[a.valKey]:t}).text(function(t){return"function"==typeof a.nameKey?a.nameKey(t):a.nameKey?t[a.nameKey]:t}),a.selected&&("boolean"==typeof a.selected?n.attr("selected",a.selected):"function"==typeof a.selected&&n.attr("selected",function(t){var e=a.valKey?t[a.valKey]:t;return a.selected(e)}))}}();var Routing={};!function(){function t(t,e){a(t);for(var n=arguments.length,r=Array(n>2?n-2:0),l=2;l<n;l++)r[l-2]=arguments[l];e&&e.apply(void 0,r),window.scrollTo(0,0)}function e(t){crossroads.parse(t)}function a(t,e){$("#page-content").html(n[t](e))}var n={};Routing.precompileTemplates=function(){$("script[type='text/x-handlebars-template']").each(function(t,e){n[e.id.replace("-template","")]=Handlebars.compile($(e).html())})},Routing.initializeRoutes=function(){crossroads.addRoute("/",function(){t("home",App.initHome)}),crossroads.addRoute("/about",function(){t("about")}),hasher.prependHash="",hasher.initialized.add(e),hasher.changed.add(e),hasher.init()}}();var App={};!function(){App.initialize=function(){},$.tooltipster.setDefaults({contentAsHTML:!0,trigger:"hover",offset:[5,-25],theme:"tooltipster-shadow",maxWidth:320}),$.noty.defaults.type="warning",$.noty.defaults.layout="center",$.noty.defaults.timeout=2e3}(),function(){App.initialize(),Routing.precompileTemplates(),Routing.initializeRoutes()}(),function(){App.buildForceDiagram=function(t,e){function a(t,n){for(var r=0;r<n;r++)A[t]=r,t===A.length-1?!function(){var t={id:"Scenario "+x,nodeNum:x,size:Math.ceil(10*Math.random()),links:[]},a=A.slice(0);a.forEach(function(a,n){var r=e[n].name,l=e[n].values[a];t.links.push({parameter:r,value:l,numValues:e[n].values.length})});var n=Math.random(),r=.2;6===e.length&&(r=.05),7===e.length&&(r=.01),n<r&&(b.children.push(t),x++)}():a(t+1,e[t+1].values.length)}function n(t,e){var a=180,n=.7,l=d3.pack().size([a,a]).padding(2),o=e[0]-a/2,c=e[1]-a/2,s=d3.hierarchy(t).sum(function(t){return t.size}).sort(function(t,e){return e.value-t.value}),u=l(s).descendants(),p=y.append("g").attr("transform","translate("+o+", "+c+")"),f=p.selectAll("g").data(u).enter().append("g").attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).each(function(t){t.node=this}),h=f.append("g").attr("class",function(t){return t.parent?t.children?"node":"node node--leaf":"node node--root"});h.append("circle").attr("r",function(t){return t.r}).filter(function(t){return t.parent}).style("fill",function(t){return t.color=r(t)}).style("opacity",n).each(function(t){var e=d3.select(document.createElement("div")),a=e.append("div");a.append("div").attr("class","tooltip-title").text(t.data.id);t.data.links.forEach(function(t){a.append("div").attr("class","tooltip-line").html("<b>"+t.parameter+":</b> "+t.value)}),$(this).tooltipster({trigger:"click",contentAsHTML:!0,minWidth:300,content:e.html()})}).on("mouseover",function(t){d3.selectAll(".ribbon").style("opacity",.01),d3.selectAll(".node").style("opacity",.2),d3.selectAll(".ribbon").filter(function(e){return t.data.id===e.source.data.id}).style("opacity",.5),d3.select(this.parentNode).style("opacity",1)}).on("mouseout",function(){d3.selectAll(".ribbon").style("opacity",.1),d3.selectAll(".node").style("opacity",n)});var v=[];u.filter(function(t){return t.parent}).forEach(function(t){t.data.links.forEach(function(e){v.push({source:Object.assign({},t),target:e})})});var g=d3.ribbon().source(function(t){var e=o+t.source.x,a=c+t.source.y,n=Math.sqrt(e*e+a*a),r=Math.PI/2-Math.atan2(-a,e);return{startAngle:r-.02,endAngle:r+.02,radius:n-t.source.r}}).target(function(t){var e=d.selectAll(".arc").filter(function(e){return e.parameter===t.target.parameter&&e.value===t.target.value}).data()[0],a=e.theta1-e.theta0,n=t.target.numValues,r=t.target.index,l=e.theta0+r/n*a,o=e.theta0+(r+1)/n*a;return{startAngle:l,endAngle:o,radius:i}});m.append("g").selectAll(".ribbon").data(v).enter().append("path").attr("class","ribbon").attr("d",g).style("fill",function(t){return t.source.color}).style("opacity",.1)}function r(t){var e=t.data.links[0].value;return U("Human"===e?.33*Math.random():"Animal"===e?.67+.33*Math.random():.33+.34*Math.random())}var l=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{top:30,right:150,bottom:30,left:150}),o=350,i=o-20,c=2*o,s=2*o,u=d3.select(t).append("svg").attr("width",c+l.left+l.right).attr("height",s+l.top+l.bottom),d=u.append("g").attr("transform","translate("+(o+l.left)+", "+(o+l.top)+")"),p=u.append("defs"),f=p.append("filter").attr("id","glow");f.append("feGaussianBlur").attr("stdDeviation","3.5").attr("result","coloredBlur");var h=f.append("feMerge");h.append("feMergeNode").attr("in","coloredBlur"),h.append("feMergeNode").attr("in","SourceGraphic");var v=p.append("linearGradient").attr("id","arc-gradient").attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");v.append("stop").attr("stop-color","lightsteelblue").attr("offset","0%"),v.append("stop").attr("stop-color","steelblue").attr("offset","100%");var m=d.append("g"),g=d.append("g"),y=d.append("g"),b={name:"background",children:[]},A=e.map(function(t){return 0}),x=0;a(0,e[0].values.length);b.children.length;e.forEach(function(t){t.numNodesForValue=[],t.values.forEach(function(e,a){var n=0,r=b.children.filter(function(a){return a.links.find(function(a){return a.parameter===t.name&&a.value===e})}).length;t.numNodesForValue.push(r),b.children.forEach(function(a){var l=a.links.find(function(a){return a.parameter===t.name&&a.value===e});l&&(l.numValues=r,l.index=n,n++)})})});var M=d3.sum(e,function(t){return t.values.length}),k=[],N=.05,R=0;e.forEach(function(t){var e=2*Math.PI*(t.values.length/M),a=e-2*N;a<0&&(a=0);var n=d3.sum(t.numNodesForValue),r=0;t.values.forEach(function(e,l){var o=R+N,i=o+a*(r/n);r+=t.numNodesForValue[l];var c=o+a*(r/n);k.push({parameter:t.name,value:e,numValues:t.values.length,index:l,theta0:i,theta1:c})}),t.theta0=R+N,R+=e,t.theta1=R-N,t.avgTheta=(t.theta1+t.theta0)/2});var T=d3.arc().innerRadius(i).outerRadius(o).padAngle(0).startAngle(function(t){return t.theta0}).endAngle(function(t){return t.theta1}),E=g.selectAll(".arc").data(k).enter().append("g").attr("class","arc");E.append("path").attr("d",T).style("fill","url(#arc-gradient)").each(function(t){$(this).tooltipster({trigger:"hover",contentAsHTML:!0,content:"<b>"+t.parameter+":</b> "+t.value})}),g.selectAll(".arc-label-path").data(e).enter().append("path").attr("id",function(t,e){return"arc-path-"+e}).attr("d",T).style("fill","none").each(function(t){var e=/(^.+?)L/,a=e.exec(d3.select(this).attr("d"))[1];if(a=a.replace(/,/g," "),t.theta1>Math.PI/2&&t.theta0<3*Math.PI/2){var n=/M(.*?)A/,r=/A(.*?)0 0 1/,l=/0 0 1 (.*?)$/,o=l.exec(a)[1],i=n.exec(a)[1],c=r.exec(a)[1];a="M"+o+"A"+c+"0 0 0 "+i}d3.select(this).attr("d",a)}),g.selectAll(".arc-label").data(e).enter().append("text").attr("class","arc-label").attr("dy",function(t){return t.theta1>Math.PI/2&&t.theta0<3*Math.PI/2?16:-6}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(t,e){return"#arc-path-"+e}).text(function(t){return t.name});var K=["#c91414","#b01622","#981930","#801c3e","#681f4c","#50225a","#382568","#202876","#082b84"],U=d3.scaleLinear().range(["#c91414","#082b84"]);d3.scaleThreshold().domain(d3.range(1,K.length-1)).range(K);K.forEach(function(t,e){var a=d3.color(t),n=p.append("linearGradient").attr("id","node-gradient-"+e).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");n.append("stop").attr("stop-color",a.brighter(1.5)).attr("offset","0%"),n.append("stop").attr("stop-color",a.darker(1.5)).attr("offset","100%");var r=p.append("linearGradient").attr("id","shadow-gradient-"+e).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");r.append("stop").attr("stop-color",a.brighter(1)).attr("offset","0%"),r.append("stop").attr("stop-color",a.brighter(1)).attr("offset","100%")});var w=Object.assign({},b);w.children=b.children.filter(function(t){return"Animal"===t.links[0].value}),n(w,[100,-20]);var z=Object.assign({},b);z.children=b.children.filter(function(t){return"Zoonotic"===t.links[0].value}),n(z,[-20,100]);var F=Object.assign({},b);F.children=b.children.filter(function(t){return"Human"===t.links[0].value}),n(F,[-70,-70])}}(),function(){App.initHome=function(){function t(){d3.selectAll(".arc").style("fill",function(t){var e=!1;return d3.selectAll("select").each(function(){var a=($(this).attr("name"),$(this).val());a.includes(t.value)&&(e=!0)}),e?"steelblue":"#bbb"}),d3.selectAll(".node").filter(function(t){return t.parent}).style("display",function(t){var e=!0;return d3.selectAll("select").each(function(){var a=$(this).attr("name"),n=$(this).val(),r=t.data.links.find(function(t){return t.parameter===a});n.includes(r.value)||(e=!1)}),d3.selectAll(".ribbon").filter(function(e){return e.source.data.id===t.data.id}).style("display",e?"inline":"none"),e?"inline":"none"})}var e=[{name:"Type",values:["Human","Animal","Zoonotic"]},{name:"Spread Modality",values:["Contagious","Non-contagious"]},{name:"Route of Transmission",values:["Airborne","Waterborne","Foodborne","Bloodborne"]},{name:"Origin",values:["Natural","Accidental","Deliberate"]},{name:"Medical Countermeasures",values:["Antivirals","Antibiotics","Vaccine","Post-exposure Prophylaxis"]},{name:"Outbreak Location",values:["Permissive","Non-permissive","Unstable","State controlled with access","State controlled without access"]},{name:"Response Level",values:["Local","Intermediate","National","Regional","Global"]}];App.buildForceDiagram(".network-map",e),$("select").multiselect({numberDisplayed:0,onChange:t,onSelectAll:t,onDeselectAll:t})}}();