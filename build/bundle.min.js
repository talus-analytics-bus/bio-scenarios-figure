"use strict";var Util={};!function(){Util.comma=d3.format(",.0f"),Util.percentize=d3.format("%"),Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},Util.sortByKey=function(t,e,a){return t.sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0}),a?t.reverse():t},Util.getInputNumVal=function(t){var e=$(t),a=Util.strToFloat(e.val());return""===a?0:isNaN(a)||a<0?(e.val(0),0):(e.val(d3.format(",")(a)),a)},Util.populateSelect=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=d3.selectAll(t).selectAll("option").data(e);r.exit().remove();var n=r.enter().append("option");r=n.merge(r).attr("value",function(t){return"function"==typeof a.valKey?a.valKey(t):a.valKey?t[a.valKey]:t}).text(function(t){return"function"==typeof a.nameKey?a.nameKey(t):a.nameKey?t[a.nameKey]:t}),a.selected&&("boolean"==typeof a.selected?r.attr("selected",a.selected):"function"==typeof a.selected&&r.attr("selected",function(t){var e=a.valKey?t[a.valKey]:t;return a.selected(e)}))}}();var Routing={};!function(){function t(t,e){a(t);for(var r=arguments.length,n=Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];e&&e.apply(void 0,n),window.scrollTo(0,0)}function e(t){crossroads.parse(t)}function a(t,e){$("#page-content").html(r[t](e))}var r={};Routing.precompileTemplates=function(){$("script[type='text/x-handlebars-template']").each(function(t,e){r[e.id.replace("-template","")]=Handlebars.compile($(e).html())})},Routing.initializeRoutes=function(){crossroads.addRoute("/",function(){t("home",App.initHome)}),crossroads.addRoute("/background",function(){t("background")}),hasher.prependHash="",hasher.initialized.add(e),hasher.changed.add(e),hasher.init()}}();var App={};!function(){App.initialize=function(){},App.getRandomFromArray=function(t,e){var a=t.length;if(e>=a)return t;var r=[];for(t.forEach(function(t,e){t.size>=5e3&&r.push(e)});r.length<e;){var n=Math.floor(a*Math.random());r.includes(n)||r.push(n)}return r.map(function(e){return t[e]})},$.tooltipster.setDefaults({contentAsHTML:!0,trigger:"hover",offset:[5,-25],theme:"tooltipster-shadow",maxWidth:320}),$.noty.defaults.type="warning",$.noty.defaults.layout="center",$.noty.defaults.timeout=2e3}(),function(){App.initialize(),Routing.precompileTemplates(),Routing.initializeRoutes()}(),function(){App.buildForceDiagram=function(t,e,a,r){function n(t,e){function n(e,d){for(var u=0;u<d;u++)i[e]=u,e===i.length-1?!function(){var e={id:"Scenario "+s,nodeNum:s,links:[],extraLinks:[]},n=Math.random();n<1/11?e.type="Animal":n<5/11?e.type="Zoonotic":e.type="Human","Animal"===e.type?e.size=Math.pow(10,.5+1.5*Math.random()):"Zoonotic"===e.type?e.size=Math.pow(10,.5+2*Math.random()):e.size=Math.pow(10,.5+2.5*Math.random());var d=i.slice(0);d.forEach(function(a,r){var n=t[r].name,o=t[r].values[a];e.links.push({parameter:n,value:o,numValues:t[r].values.length}),e[n]=o}),a.concat(r).forEach(function(t){var a=t.values.length,r=Math.floor(a*Math.random()),n=t.values[r];"Stakeholders"===t.name&&(n="Medical and Public Health, Logistics","Natural"!==e.Origin&&(n+=", Law Enforcement"),"Deliberate"===e.Origin&&(n+=", Security/Military"),"Animal"===e.type&&Math.random()<.5&&(n+=", Trade"),"Zoonotic"===e.type&&Math.random()<.25&&(n+=", Trade"),"Human"===e.type&&Math.random()<.15&&(n+=", Trade")),e.extraLinks.push({parameter:t.name,value:n,numValues:a}),e[t.name]=n});var u=!0;"Non-communicable"===e["Spread Modality"]&&("Zoonotic"===e.type&&(u=!1),"International"===e["Policy Measures"]&&(u=!1),"BSL3"!==e.Diagnostics&&"BSL4"!==e.Diagnostics||(u=!1),"Bloodborne"===e["Route of Transmission"]&&(u=!1),"Vector-borne"===e["Route of Transmission"]&&(u=!1)),"Bloodborne"===e["Route of Transmission"]&&"Accidental"===e.Origin&&(u=!1),"Targeted"===e["Populations Affected"]&&"Natural"===e.Origin&&(u=!1),"Law Enforcement"===e.Stakeholders&&"Natural"===e.Origin&&(u=!1),"Waterborne"===e["Route of Transmission"]&&"Containment Suit"===e["Personal Protective Equipment"]&&(u=!1),"Waterborne"===e["Route of Transmission"]&&"Respirator"===e["Personal Protective Equipment"]&&(u=!1),"Foodborne"===e["Route of Transmission"]&&"Containment Suit"===e["Personal Protective Equipment"]&&(u=!1),"Foodborne"===e["Route of Transmission"]&&"Respirator"===e["Personal Protective Equipment"]&&(u=!1),"State controlled without access"===e["Outbreak Location"]&&"Trade"===e.Stakeholders&&(u=!1),"Accidental"===e["Event Origin"]&&"Targeted"===e["Population Affected"]&&(u=!1);for(var p in o)if(o[p].includes(e[p])){u=!1;break}u&&(c<3&&"Animal"!==e.type&&Math.random()<.01&&(e.size=5e3+5e3*Math.random(),c++),l.children.push(e),s++)}():n(e+1,t[e+1].values.length)}var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};console.log(t);var l={name:"background",children:[]},i=t.map(function(t){return 0}),s=0,c=0;return n(0,t[0].values.length),l.children=App.getRandomFromArray(l.children,e),t.forEach(function(t){t.numNodesForValue=[],t.values.forEach(function(e,a){var r=0,n=l.children.filter(function(a){return a.links.find(function(a){return a.parameter===t.name&&a.value===e})}).length;t.numNodesForValue.push(n),l.children.forEach(function(a){var o=a.links.find(function(a){return a.parameter===t.name&&a.value===e});o&&(o.numValues=n,o.index=r,r++)})})}),l}function o(t){var e=[0,0],a=280,r=.7,n=d3.pack().size([a,a]).padding(2),o=e[0]-a/2,i=e[1]-a/2,s=d3.hierarchy(t).sum(function(t){return t.size}).sort(function(t,e){return e.value-t.value}),d=n(s).descendants(),u=A.append("g").attr("class","node-g-container").attr("transform","translate("+o+", "+i+")"),p=u.selectAll("g").data(d).enter().append("g").attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).each(function(t){t.node=this}),h=p.append("g").attr("class",function(t){return t.parent?t.children?"node":"node node--leaf":"node node--root"});h.append("circle").attr("r",function(t){return t.r}).filter(function(t){return t.parent}).style("fill",function(t){return t.color=l(t)}).style("opacity",r).each(function(t){var e=d3.select(document.createElement("div")),a=e.append("div");a.append("div").attr("class","tooltip-title").text(t.data.id);a.append("div").attr("class","tooltip-line").html("<b>Primary Spread Type:</b> "+t.data.type),t.data.links.forEach(function(t){a.append("div").attr("class","tooltip-line").html("<b>"+t.parameter+":</b> "+t.value)}),t.data.extraLinks.forEach(function(t){a.append("div").attr("class","tooltip-line").html("<b>"+t.parameter+":</b> "+t.value)}),$(this).tooltipster({trigger:"click",contentAsHTML:!0,minWidth:350,content:e.html()})}).on("mouseover",function(t){d3.selectAll(".ribbon").style("opacity",.01),d3.selectAll(".node circle").style("opacity",.2),d3.selectAll(".ribbon").filter(function(e){return t.data.id===e.source.data.id}).style("opacity",.5),d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.selectAll(".ribbon").style("opacity",.1),d3.selectAll(".node circle").style("opacity",r)});var m=[];d.filter(function(t){return t.parent}).forEach(function(t){t.data.links.forEach(function(e){m.push({source:Object.assign({},t),target:e})})});var v=d3.ribbon().source(function(t){var e=o+t.source.x,a=i+t.source.y,r=Math.sqrt(e*e+a*a),n=Math.PI/2-Math.atan2(-a,e);return{startAngle:n-.02,endAngle:n+.02,radius:r}}).target(function(t){var e=f.selectAll(".arc").filter(function(e){return e.parameter===t.target.parameter&&e.value===t.target.value}).data()[0],a=e.theta1-e.theta0,r=t.target.numValues,n=t.target.index,o=e.theta0+n/r*a,l=e.theta0+(n+1)/r*a;return{startAngle:o,endAngle:l,radius:c}});b.append("g").attr("class","ribbon-g-container").selectAll(".ribbon").data(m).enter().append("path").attr("class","ribbon").attr("d",v).style("fill",function(t){return t.source.color}).style("opacity",.1)}function l(t){var e=t.data.type;return E("Human"===e?.33*Math.random():"Animal"===e?.67+.33*Math.random():.33+.34*Math.random())}var i=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},{top:40,right:20,bottom:20,left:20}),s=350,c=s-20,d=2*s,u=2*s,p=d3.select(t).append("svg").attr("width",d+i.left+i.right).attr("height",u+i.top+i.bottom),f=p.append("g").attr("transform","translate("+(s+i.left)+", "+(s+i.top)+")"),h=p.append("defs"),m=h.append("filter").attr("id","glow");m.append("feGaussianBlur").attr("stdDeviation","3.5").attr("result","coloredBlur");var v=m.append("feMerge");v.append("feMergeNode").attr("in","coloredBlur"),v.append("feMergeNode").attr("in","SourceGraphic");var g=h.append("linearGradient").attr("id","arc-gradient").attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");g.append("stop").attr("stop-color","lightsteelblue").attr("offset","0%"),g.append("stop").attr("stop-color","steelblue").attr("offset","100%");var y=h.append("linearGradient").attr("id","arc-gradient-empty").attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");y.append("stop").attr("stop-color","#bbb").attr("offset","0%"),y.append("stop").attr("stop-color","#999").attr("offset","100%");var b=f.append("g"),x=f.append("g"),A=f.append("g"),M=n(e,50),w=d3.sum(e,function(t){return t.values.length}),P=[],k=.04,R=0;e.forEach(function(t){var e=2*Math.PI*(t.values.length/w),a=e-2*k;a<0&&(a=0);var r=d3.sum(t.numNodesForValue),n=0;t.values.forEach(function(e,o){var l=R+k,i=l+a*(n/r);n+=t.numNodesForValue[o];var s=l+a*(n/r);P.push({parameter:t.name,value:e,numValues:t.values.length,index:o,theta0:i,theta1:s})}),t.theta0=R+k,R+=e,t.theta1=R-k,t.avgTheta=(t.theta1+t.theta0)/2});var N=d3.arc().innerRadius(c).outerRadius(s).padAngle(0).startAngle(function(t){return t.theta0}).endAngle(function(t){return t.theta1}),L=d3.arc().innerRadius(c).outerRadius(s).padAngle(0).startAngle(function(t){return t.theta1-t.theta0>1?t.theta0:t.theta0-1}).endAngle(function(t){return t.theta1-t.theta0>1?t.theta1:t.theta1+1}),S=x.selectAll(".arc").data(P).enter().append("g").attr("class","arc active").style("fill","url(#arc-gradient)");S.append("path").attr("d",N).each(function(t){$(this).tooltipster({trigger:"hover",contentAsHTML:!0,content:"<b>"+t.parameter+":</b> "+t.value})}),x.selectAll(".arc-label-path").data(e).enter().append("path").attr("id",function(t,e){return"arc-path-"+e}).attr("d",L).style("fill","none").each(function(t){var e=/(^.+?)L/,a=e.exec(d3.select(this).attr("d"))[1];a=a.replace(/,/g," ");var r=(t.theta0+t.theta1)/2;if(r>Math.PI/2&&r<3*Math.PI/2){var n=/M(.*?)A/,o=/A(.*?)0 0 1/,l=/0 0 1 (.*?)$/,i=l.exec(a)[1],s=n.exec(a)[1],c=o.exec(a)[1];a="M"+i+"A"+c+"0 0 0 "+s}d3.select(this).attr("d",a)}),x.selectAll(".arc-label").data(e).enter().append("text").attr("class","arc-label").attr("dy",function(t){var e=(t.theta0+t.theta1)/2;return e>Math.PI/2&&e<3*Math.PI/2?20:-8}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(t,e){return"#arc-path-"+e}).text(function(t){return t.name});var T=["#c91414","#b01622","#981930","#801c3e","#681f4c","#50225a","#382568","#202876","#082b84"],E=d3.scaleLinear().range(["#c91414","#082b84"]);d3.scaleThreshold().domain(d3.range(1,T.length-1)).range(T);return T.forEach(function(t,e){var a=d3.color(t),r=h.append("linearGradient").attr("id","node-gradient-"+e).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");r.append("stop").attr("stop-color",a.brighter(1.5)).attr("offset","0%"),r.append("stop").attr("stop-color",a.darker(1.5)).attr("offset","100%");var n=h.append("linearGradient").attr("id","shadow-gradient-"+e).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");n.append("stop").attr("stop-color",a.brighter(1)).attr("offset","0%"),n.append("stop").attr("stop-color",a.brighter(1)).attr("offset","100%")}),o(M),f.append("text").attr("class","no-scenario-text").style("text-anchor","middle").text("No scenarios fit the above filters."),{getNodeData:n,createNodePack:o}}}(),function(){App.initHome=function(){function t(t,e){var a=d3.select(t).selectAll(".dropdown-box").data(e).enter().append("div").attr("class","dropdown-box");a.append("div").attr("class","dropdown-label").text(function(t){return t.name});var r=a.append("select").attr("class","type-select form-control").attr("name",function(t){return t.name}).attr("multiple","multiple");r.selectAll("option").data(function(t){return t.values}).enter().append("option").attr("selected",!0).attr("value",function(t){return t}).text(function(t){return t})}function e(){NProgress.start(),d3.selectAll(".arc").style("fill",function(t){var e=!1;return d3.selectAll("select").each(function(){var a=$(this).attr("name"),r=$(this).val();t.parameter===a&&r.includes(t.value)&&(e=!0)}),e?$(this).addClass("active"):$(this).removeClass("active"),e?"url(#arc-gradient)":"url(#arc-gradient-empty)"});var t={};d3.selectAll("select").each(function(){var e=$(this).attr("name"),a=[];$(this).find("option:not(:selected)").each(function(){a.push($(this).val())}),a.length&&(t[e]=a)}),d3.selectAll(".node-g-container, .ribbon-g-container").remove();var e=s.getNodeData(l,50,t);s.createNodePack(e);var a=$(".node").length;$(".no-scenario-text").css("display",a>1?"none":"inline"),NProgress.done()}for(var a=[{name:"Spread Modality",values:["Communicable","Non-communicable"]},{name:"Route of Transmission",values:["Airborne","Waterborne","Foodborne","Bloodborne","Vector-borne"]},{name:"Event Origin",values:["Natural","Accidental","Deliberate"]},{name:"Medical Countermeasures",values:["Antivirals","Antibiotics","Vaccine","Post-exposure Prophylaxis","None"]},{name:"Outbreak Location",values:["Permissive","Non-permissive","Unstable","State controlled with access","State controlled without access"]},{name:"Response Level",values:["Local","Intermediate","National","Regional","Global"]},{name:"Policy Measures",values:["National","International","None"]},{name:"Diagnostics",values:["Point of Care","BSL1","BSL2","BSL3","BSL4"]},{name:"Morbidity Rate",values:["Low","Medium","Severe","Short-term","Long-term"]},{name:"Population Affected",values:["All","Pregnant Women","Children","Elderly","Targeted"]},{name:"Personal Protective Equipment",values:["Mask, Gloves, Gown","Respirator","Containment Suit"]},{name:"Fatality Rate",values:["Very Low","Low","Medium","High","Very High"]}],r=[{name:"Stakeholders",values:["Medical and Public Health","Law Enforcement","Logistics","Security/Military","Trade"]}],n=[];n.length<7;){var o=Math.floor(a.length*Math.random());n.includes(o)||n.push(o)}var l=a.filter(function(t,e){return n.includes(e)}),i=a.filter(function(t,e){return!n.includes(e)}),s=App.buildForceDiagram(".network-map",l,i,r);t(".filters-container .dropdown-row:first-child",l.slice(0,5)),t(".filters-container .dropdown-row:nth-child(2)",l.slice(5)),t(".filters-container .extra-dropdown-row",i),$("select").multiselect({numberDisplayed:0,onChange:e,onSelectAll:e,onDeselectAll:e});d3.selectAll(".arc").on("click",function(t){var a=$('select[name="'+t.parameter+'"]'),r=a.find("option").length;if(a.val().length===r)a.multiselect("deselectAll",!1).multiselect("select",t.value);else{var n=$(this),o=n.hasClass("active"),l=o?"deselect":"select";a.multiselect(l,t.value)}a.multiselect("refresh"),e()}),$(".shuffle-button").click(e),$(".reset-button").click(function(){$("select").multiselect("selectAll",!1).multiselect("refresh"),e()}),$(".show-more-filters-button").click(function(){$(".extra-dropdown-row").slideDown(),$(".show-more-filters-button").slideUp(),$(".figure-container").addClass("expanded")}),$(".show-more-description-button").click(function(){$(".extra-description").slideDown(),$(".show-more-description-button").slideUp()});var c=16,d=300,u=d3.select(".network-map-legend").append("svg").attr("width",800).attr("height",c+75),p=u.append("g").attr("transform","translate(42, 45)"),f=u.append("defs"),h=f.append("linearGradient").attr("id","legend-gradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");h.append("stop").attr("stop-color","#c91414").attr("offset","0%"),h.append("stop").attr("stop-color","#082b84").attr("offset","100%"),p.append("rect").attr("class","legend-bar").attr("width",d).attr("height",c).style("opacity",.75).style("fill","url(#legend-gradient)"),p.append("text").attr("class","legend-text").attr("y",c+12).attr("dy",".35em").text("Human"),p.append("text").attr("class","legend-text").attr("x",d/2).attr("y",c+12).attr("dy",".35em").text("Zoonotic"),p.append("text").attr("class","legend-text").attr("x",d).attr("y",c+12).attr("dy",".35em").text("Animal");var m=p.append("g").attr("transform","translate("+(d+200)+", "+c+")");m.append("circle").attr("cx",5).attr("r",5).attr("fill","#681f4c"),m.append("circle").attr("cx",130).attr("r",20).attr("fill","#681f4c"),m.append("circle").attr("cx",40).attr("r",10).attr("fill","#681f4c"),m.append("circle").attr("cx",80).attr("r",15).attr("fill","#681f4c"),m.append("text").attr("class","legend-text").attr("x",-23).attr("y",-9).attr("dy",".35em").style("text-anchor","end").text("Fewer"),m.append("text").attr("class","legend-text").attr("x",-23).attr("y",10).attr("dy",".35em").style("text-anchor","end").text("Fatalities"),m.append("text").attr("class","legend-text").attr("x",170).attr("y",-9).attr("dy",".35em").style("text-anchor","start").text("More"),m.append("text").attr("class","legend-text").attr("x",170).attr("y",10).attr("dy",".35em").style("text-anchor","start").text("Fatalities"),m.append("text").attr("class","legend-text").attr("x",72).attr("y",-32).style("text-anchor","middle").text("Biological Event")}}();