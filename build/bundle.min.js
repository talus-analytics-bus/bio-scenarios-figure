"use strict";var Util={};!function(){Util.comma=d3.format(",.0f"),Util.percentize=d3.format("%"),Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},Util.sortByKey=function(t,e,n){return t.sort(function(t,n){return t[e]<n[e]?-1:t[e]>n[e]?1:0}),n?t.reverse():t},Util.getInputNumVal=function(t){var e=$(t),n=Util.strToFloat(e.val());return""===n?0:isNaN(n)||n<0?(e.val(0),0):(e.val(d3.format(",")(n)),n)},Util.populateSelect=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=d3.selectAll(t).selectAll("option").data(e);r.exit().remove();var a=r.enter().append("option");r=a.merge(r).attr("value",function(t){return"function"==typeof n.valKey?n.valKey(t):n.valKey?t[n.valKey]:t}).text(function(t){return"function"==typeof n.nameKey?n.nameKey(t):n.nameKey?t[n.nameKey]:t}),n.selected&&("boolean"==typeof n.selected?r.attr("selected",n.selected):"function"==typeof n.selected&&r.attr("selected",function(t){var e=n.valKey?t[n.valKey]:t;return n.selected(e)}))}}();var Routing={};!function(){function t(t,e){n(t);for(var r=arguments.length,a=Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];e&&e.apply(void 0,a),window.scrollTo(0,0)}function e(t){crossroads.parse(t)}function n(t,e){$("#page-content").html(r[t](e))}var r={};Routing.precompileTemplates=function(){$("script[type='text/x-handlebars-template']").each(function(t,e){r[e.id.replace("-template","")]=Handlebars.compile($(e).html())})},Routing.initializeRoutes=function(){crossroads.addRoute("/",function(){t("home",App.initHome)}),crossroads.addRoute("/about",function(){t("about")}),hasher.prependHash="",hasher.initialized.add(e),hasher.changed.add(e),hasher.init()}}();var App={};!function(){App.initialize=function(){},$.tooltipster.setDefaults({contentAsHTML:!0,trigger:"hover",offset:[5,-25],theme:"tooltipster-shadow",maxWidth:320}),$.noty.defaults.type="warning",$.noty.defaults.layout="center",$.noty.defaults.timeout=2e3}(),function(){App.initialize(),Routing.precompileTemplates(),Routing.initializeRoutes()}(),function(){App.buildForceDiagram=function(t,e,n){function r(t,e){var n=t-l,r=e-l,a=Math.sqrt(n*n+r*r),o=c-30;return a<o?t:n>0?t-10:t+10}function a(t,e){var n=t-l,r=e-l,a=Math.sqrt(n*n+r*r),o=c-30;return a<o?e:r>0?e-10:e+10}var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={top:20,right:20,bottom:20,left:20},l=250,c=l-15,s=2*l,u=2*l,d=d3.select(t).append("svg").attr("width",s+i.left+i.right).attr("height",u+i.top+i.bottom).append("g").attr("transform","translate("+(l+i.left)+", "+(l+i.top)+")"),f=d.append("g"),p=d.append("g"),g=d.append("g"),y=d3.chord().padAngle(.05).sortSubgroups(d3.descending),h=d3.arc().innerRadius(c).outerRadius(l),v=d3.scaleOrdinal().domain(d3.range(12)).range(["#e6f5ff","#ccebff","#b3e0ff","#66c2ff","#748FA1","#637B8A","#313D45","#C0DCED","#C0EDCE","#A6E6BA","#84B894","#53735D","#F2E3D2","#EBD2B7","#A18B74","#736353"]),m=[[200,6295,893,91,1820,4245,1176,1399,1157,7586,1616,1870],[1685,4266,3858,2929,7621,9230,1051,1116,701,1749,8886,853],[8048,4055,5836,5001,10799,12662,11745,5029,16973,18479,2722,13652],[12958,7227,14303,1310,13314,5413,7843,17878,536,9371,14537,17700],[10362,15302,5379,2834,15747,19423,11276,18460,17491,9648,2419,8974],[5004,3956,15488,16646,2614,10712,9502,10110,306,12531,12050,12052],[19144,14701,6777,10999,14988,5205,8200,11717,4032,18179,15831,10649],[12496,846,11719,9697,3007,17794,8242,19855,16990,6714,2999,4658],[9774,9250,9730,8145,14544,15329,13342,6569,8838,5778,17125,11046],[18486,4791,17489,15943,17331,2337,19419,7972,15708,7965,16729,17216],[1251,19170,2970,11084,9388,10915,124,10930,13946,13175,17185,1338],[18505,4456,1411,11245,4103,2165,19720,10395,16880,3863,3897,519]];p.datum(y(m));var b=p.append("g").attr("class","groups").selectAll("g").data(function(t){return t.groups}).enter().append("g");b.append("path").style("fill",function(t,e){return v(e)}).attr("d",h);var A=d3.forceSimulation().velocityDecay(o.velocityDecay||.2).force("link",d3.forceLink().id(function(t){return t.id})).force("charge",d3.forceManyBody().strength(-3)).force("center",d3.forceCenter(0,0)),x=d3.scaleLinear().domain([0,10]).range([5,22]),k=d3.scaleLinear().domain([0,50]).range(["#082b84","#c91414"]),D=g.append("g").attr("class","links").selectAll(".link").data(n).enter().append("line").attr("class","link"),K=g.append("g").attr("class","nodes").selectAll(".node").data(e).enter().append("circle").attr("class","node").attr("r",function(t){return x(t.extremity)}).style("fill",function(t,e){return k(e)}).each(function(t){$(this).tooltipster({trigger:"hover",content:t.id})}).on("mouseover",function(t){d3.selectAll(".ribbon").filter(function(e){return e.id===t.id}).classed("active",!0)}).on("mouseout",function(t){d3.selectAll(".ribbon").classed("active",!1)}),R=50,U=0;A.nodes(e).on("tick",function(){D.attr("x1",function(t){return r(t.source.x,t.source.y)}).attr("y1",function(t){return a(t.source.x,t.source.y)}).attr("x2",function(t){return r(t.target.x,t.target.y)}).attr("y2",function(t){return a(t.target.x,t.target.y)}),K.attr("cx",function(t){return r(t.x,t.y)}).attr("cy",function(t){return a(t.x,t.y)}),d3.selectAll(".ribbon").attr("d",w),U++,U===R&&A.stop()}),A.force("link").links(n);var w=d3.ribbon().source(function(t){var e=r(t.x,t.y),n=a(t.x,t.y),o=Math.sqrt(e*e+n*n),i=Math.PI/2-Math.atan2(-n,e);return{startAngle:i,endAngle:i,radius:o}}).target(function(t){var e=2*Math.PI*Math.random();return{startAngle:e,endAngle:e+.1,radius:c}});f.append("g").attr("class","ribbons").selectAll(".ribbon").data(e).enter().append("path").attr("class","ribbon").attr("d",w).style("fill","lightsteelblue").style("stroke","rgba(0,0,0,0.5)")}}(),function(){App.initHome=function(){d3.queue().defer(d3.tsv,"data/network_nodes.tsv").defer(d3.tsv,"data/network_edges.tsv").await(function(t,e,n){App.buildForceDiagram(".network-map",e,n)})}}();